# 拓扑结构评估算法测试报告

## 概述

本报告展示了基于拓扑结构的图编辑评估算法在不同拓扑差异情况下的表现。

## 测试数据说明

### 完美匹配（基准）
- **small_perfect**: 3条转换，状态名称不同但拓扑完全相同
- **medium_perfect**: 11条转换，状态名称不同但拓扑完全相同
- **large_perfect**: 23条转换，状态名称不同但拓扑完全相同

### 拓扑差异情况

1. **缺少边的情况**
   - `small_missing`: 缺少1条边（3条→2条）
   - `medium_missing`: 缺少3条边（11条→8条）
   - `large_missing`: 缺少2条边（23条→21条）

2. **多余边的情况**
   - `small_extra`: 多1条边（3条→4条）
   - `medium_extra`: 多2条边（11条→13条）
   - `large_extra`: 多2条边（23条→25条，包含自循环）

3. **混合差异情况**
   - `medium_mixed`: 缺少4条边，多1条边（11条→8条，但结构不同）

## 评估结果

### 1. 完美匹配情况

| 测试用例 | Precision | Recall | F1 | 编辑距离 | 相似度 | 映射覆盖率 |
|---------|-----------|--------|-----|---------|--------|-----------|
| small_perfect | 1.0000 | 1.0000 | 1.0000 | 0.0 | 1.0000 | 1.0000 |
| medium_perfect | 1.0000 | 1.0000 | 1.0000 | 0.0 | 1.0000 | 1.0000 |
| large_perfect | 1.0000 | 1.0000 | 1.0000 | 0.0 | 1.0000 | 1.0000 |

**结论**: 算法能够完美识别拓扑结构相同的图，即使状态名称完全不同。

### 2. 缺少边的情况

| 测试用例 | Precision | Recall | F1 | 编辑距离 | 相似度 | 映射覆盖率 |
|---------|-----------|--------|-----|---------|--------|-----------|
| small_missing | 1.0000 | 0.7500 | 0.8571 | 2.0 | 0.8333 | 1.0000 |
| medium_missing | 1.0000 | 0.7500 | 0.8571 | 8.0 | 0.7647 | 1.0000 |
| large_missing | 1.0000 | 0.7778 | 0.8750 | 3.0 | 0.9524 | 1.0000 |

**观察**:
- Precision = 1.0：预测的所有序列都是正确的（没有假阳性）
- Recall < 1.0：遗漏了一些GT中的序列（假阴性）
- 编辑距离和相似度反映了缺失的边数

### 3. 多余边的情况

| 测试用例 | Precision | Recall | F1 | 编辑距离 | 相似度 | 映射覆盖率 |
|---------|-----------|--------|-----|---------|--------|-----------|
| small_extra | 0.8000 | 1.0000 | 0.8889 | 6.0 | 0.6250 | 0.8000 |
| medium_extra | 0.7500 | 1.0000 | 0.8571 | 2.0 | 0.9500 | 1.0000 |
| large_extra | 0.4500 | 1.0000 | 0.6207 | 2.0 | 0.9697 | 1.0000 |

**观察**:
- Recall = 1.0：GT中的所有序列都被预测到了（没有假阴性）
- Precision < 1.0：预测中包含了一些GT中不存在的序列（假阳性）
- `large_extra` 的 Precision 较低（0.45），因为多余的边产生了大量额外的序列（36→80）

### 4. 混合差异情况

| 测试用例 | Precision | Recall | F1 | 编辑距离 | 相似度 | 映射覆盖率 |
|---------|-----------|--------|-----|---------|--------|-----------|
| medium_mixed | 0.8000 | 0.6667 | 0.7273 | 7.0 | 0.7879 | 1.0000 |

**观察**:
- Precision 和 Recall 都小于1.0，说明既有假阳性也有假阴性
- F1分数（0.7273）反映了整体性能的下降
- 编辑距离（7.0）反映了结构差异的程度

## 关键发现

1. **状态映射能力**: 算法能够正确识别拓扑结构相似的状态，映射覆盖率在大多数情况下为100%

2. **缺少边 vs 多余边**:
   - **缺少边**: Precision高（1.0），Recall较低，说明算法保守，不会产生错误的序列
   - **多余边**: Recall高（1.0），Precision较低，说明算法会包含所有正确的序列，但也会包含一些错误的

3. **规模影响**: 
   - 小规模数据：差异更容易被检测到
   - 大规模数据：即使有差异，相似度仍然较高（因为差异相对较小）

4. **编辑距离 vs 序列指标**:
   - 编辑距离更关注结构差异
   - 序列指标（Precision/Recall/F1）更关注行为差异
   - 两者结合提供了更全面的评估

## 算法优势

1. ✅ **拓扑感知**: 能够识别状态名称不同但拓扑结构相同的图
2. ✅ **鲁棒性**: 在存在拓扑差异时仍能提供有意义的评估
3. ✅ **多指标**: 同时提供序列级和结构级的评估指标
4. ✅ **可解释性**: 提供状态映射信息，便于理解评估结果

## 算法局限性

1. ⚠️ **贪心匹配**: 状态映射使用贪心算法，可能不是最优匹配
2. ⚠️ **复杂图**: 对于非常复杂的图，映射可能不够准确
3. ⚠️ **多余边影响**: 当存在大量多余边时，会产生大量假阳性序列

## 建议

1. 对于缺少边的情况，关注 Recall 指标
2. 对于多余边的情况，关注 Precision 指标
3. 结合编辑距离和序列指标进行综合评估
4. 查看状态映射结果，验证映射的合理性

## 总结

基于拓扑结构的评估算法能够有效处理状态名称不同但拓扑结构相同或相似的情况，为图编辑评估提供了更灵活和实用的方法。在不同类型的拓扑差异下，算法都能提供有意义的评估指标，帮助理解预测结果与真实结果的差异。
